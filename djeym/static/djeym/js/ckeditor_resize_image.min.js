var runCKEditorResizeImage;$(document).ready(function(){"use strict";try{CKEDITOR.on("dialogDefinition",function(event){let dialogName=event.data.name,dialogDefinition=event.data.definition;if("image"===dialogName){let onOk=dialogDefinition.onOk;dialogDefinition.onOk=function(event){let width=this.getContentElement("info","txtWidth"),height=this.getContentElement("info","txtHeight"),tmpWidth=+width.getValue();tmpWidth>322&&(height.setValue(Math.floor(+height.getValue()*(322/tmpWidth))),width.setValue("322")),onOk&&onOk.apply(this,event)}}}),runCKEditorResizeImage=function(){function creatingThumbnails(fileUpload,formOfUpload){if(void 0!==fileUpload){let fileType=fileUpload.type;if("image/jpeg"!==fileType&&"image/png"!==fileType)return formOfUpload.trigger("reset"),void alert(gettext("Only JPG and PNG files."));const MAX_WIDTH=966,MAX_HEIGHT=966;let reader=new FileReader,tempImg=new Image,tempW,tempH,uploadIndicator=$("img.cke_image_upload_indicator");uploadIndicator.css("display","block"),reader.onload=function(event){tempImg.onload=function(){tempW=tempImg.width,tempH=tempImg.height,tempW>tempH?tempW>MAX_WIDTH&&(tempH=Math.floor(tempH*(MAX_WIDTH/tempW)),tempW=MAX_WIDTH):tempH>MAX_HEIGHT&&(tempW=Math.floor(tempW*MAX_HEIGHT/tempH),tempH=MAX_HEIGHT);let canvas=document.getElementById("cke_temp_canvas"),ctx=canvas.getContext("2d");ctx.clearRect(0,0,canvas.width,canvas.height),canvas.width=tempW,canvas.height=tempH,ctx.drawImage(tempImg,0,0,tempW,tempH);let dataURI=canvas.toDataURL(fileType),imageBlob=function(){let binary=atob(dataURI.split(",")[1]),array=[];for(let idx=0;idx<binary.length;idx++)array.push(binary.charCodeAt(idx));return new Blob([new Uint8Array(array)],{type:fileType})}(),tempFormData=new FormData;tempFormData.append("upload",imageBlob,fileUpload.name),$.ajax({type:"POST",url:formOfUpload.attr("action"),data:tempFormData,processData:!1,contentType:!1}).done(function(response){}).fail(function(){alert(gettext("Server Error ???"))}).always(function(){uploadIndicator.css("display","none"),formOfUpload.trigger("reset")})},tempImg.src=event.target.result},reader.readAsDataURL(fileUpload)}}$(document).on("click","a.cke_dialog_tab_selected",function(event){let $this,commonParent=$(this).parent().parent(),buttonLoadOnServer,parentOfButton=commonParent.find("a.cke_dialog_ui_fileButton").parent(),iframeContents,formOfUpload=commonParent.find("td.cke_dialog_ui_vbox_child iframe").contents().find("form"),controlAgent=parentOfButton.find("div.cke_control_agent");0!==controlAgent.length&&(commonParent.find("tr.cke_info_upload_image").remove(),controlAgent.off("click"),controlAgent.remove()),parentOfButton.css("position","relative"),parentOfButton.parent().before("<tr class='cke_info_upload_image'><td><img src='/static/djeym/img/loader.gif' class='cke_image_upload_indicator' style='display: none; margin: 20px 0;' alt='upload indicator'><div>"+gettext("Image size will be optimized to 966 pixels.")+"</div></td></tr>"),commonParent.find("tr.cke_info_upload_image td div").css({margin:"20px 0 10px",color:"#0782c1","font-size":"14px","font-weight":"bold"}),parentOfButton.prepend("<div class='cke_control_agent'></div>"),(controlAgent=parentOfButton.find("div.cke_control_agent")).css({position:"absolute",top:"0",right:"0",bottom:"0",left:"0","z-index":"1",cursor:"pointer"}),controlAgent.on("click",function(event){if(!(window.File&&window.FileReader&&window.FileList&&window.Blob))return void alert(gettext("The File APIs are not fully supported in this browser. Upgrade your browser - http://browsehappy.com/"));let fileUpload;creatingThumbnails(formOfUpload.find('input[name="upload"]')[0].files[0],formOfUpload)})})},$("form").is("#id_form_geoobjects")||runCKEditorResizeImage()}catch(err){}});