function init(){"use strict";let Map,globalButtonShowPanel,globalTemp,globalObjMngPlacemark,globalObjMngPolyline,globalObjMngPolygon,globalHeatmap,globalHeatPoints;const GLOBAL_BOXIOS_SIZE="middle";let globalRestartID1,globalRestartID2,globalRestartID3,globalRestartID4;function waitLoadContent(){globalRestartID4=setTimeout(function(){let loadIndicator=document.getElementById("djeymLoadIndicator");if(null===loadIndicator)return;loadIndicator.style.display="block";let $images=$("ymaps:regex(class, .*-balloon__content) img"),imgLoaded=!1,counter=0;if(0===$images.length?imgLoaded=!0:($images.each(function(){this.complete&&counter++}),counter===$images.length&&(imgLoaded=!0)),$("div").is("#djeymSignLoaded")&&imgLoaded){$(".djeymUpdateInfoPreset").each(function(){$(this).trigger("click")});let modalLock=document.getElementById("djeymModalLock");null!==modalLock&&(globalRestartID2=setTimeout(function(){globalRestartID1=setTimeout(function(){modalLock.remove()},600),modalLock.style.opacity=0},200))}else globalRestartID3=setTimeout(function(){waitLoadContent()},100)},500)}if(jQuery.expr[":"].regex=function(elem,index,match){let matchParams=match[3].split(","),validLabels=/^(data|css):/,attr={method:matchParams[0].match(validLabels)?matchParams[0].split(":")[0]:"attr",property:matchParams.shift().replace(validLabels,"")},regexFlags="ig",regex;return new RegExp(matchParams.join("").replace(/^\s+|\s+$/g,""),"ig").test(jQuery(elem)[attr.method](attr.property))},null===(Map=new djeymYMaps.Map("djeymYMapsID",{center:window.djeymCenterMap,zoom:window.djeymZoomMap,type:void 0===window.djeymTile?window.djeymMapType:null,controls:window.djeymControls},{maxZoom:void 0===window.djeymTile?23:window.djeymTile.maxZoom,minZoom:void 0===window.djeymTile?0:window.djeymTile.minZoom,hasHint:!1})).getType()&&Map.controls.get("typeSelector").options.set("visible",!1),window.djeymRoundTheme){globalTemp=window.djeymControls.length;for(let idx=0;idx<globalTemp;idx++)switch(window.djeymControls[idx]){case"geolocationControl":Map.controls.get("geolocationControl").options.set({size:"small"});break;case"searchControl":Map.controls.get("searchControl").options.set({size:"small"});break;case"routeButtonControl":Map.controls.get("routeButtonControl").options.set({size:"small"});break;case"trafficControl":Map.controls.get("trafficControl").options.set({size:"small"});break;case"typeSelector":Map.controls.get("typeSelector").options.set({size:"small"});break;case"fullscreenControl":Map.controls.get("fullscreenControl").options.set({size:"small"});break;case"zoomControl":Map.controls.get("zoomControl").options.set({size:"small"});break;case"rulerControl":Map.controls.get("rulerControl").options.set({size:"small"})}}window.djeymControls.includes("searchControl")&&window.djeymSearchProvider&&Map.controls.get("searchControl").options.set("provider","yandex#search"),void 0!==window.djeymTile&&(Map.layers.add(new djeymYMaps.Layer(window.djeymSource(),{projection:djeymYMaps.projection.sphericalMercator})),window.djeymTile.copyrights.length>0&&Map.copyrights.add(window.djeymTile.copyrights)),window.djeymHeatmap&&djeymYMaps.modules.require(["Heatmap"],function(Heatmap){(globalHeatmap=new Heatmap(globalHeatPoints={type:"FeatureCollection",features:[]},{radius:window.djeymHeatmapRadius,dissipating:window.djeymHeatmapDissipating,opacity:window.djeymHeatmapOpacity,intensityOfMidpoint:window.djeymHeatmapIntensity,gradient:{.1:window.djeymHeatmapGradientColor1,.2:window.djeymHeatmapGradientColor2,.7:window.djeymHeatmapGradientColor3,1:window.djeymHeatmapGradientColor4}})).setMap(Map)}),window.djeymDisableSitePanel||(globalButtonShowPanel=new djeymYMaps.control.Button({data:{image:"/static/djeym/img/front_open_panel.svg"},options:{size:"small",selectOnClick:!1,maxWidth:28}})).events.add("click",function(){document.getElementById("id_djeym_sidenav").style.left="0"}),Map.events.add("balloonopen",function(){clearTimeout(globalRestartID1),clearTimeout(globalRestartID2),clearTimeout(globalRestartID3),clearTimeout(globalRestartID4),waitLoadContent()}),$(document).on("click","ymaps:regex(class, .*-cluster-tabs__menu-item.*), ymaps:regex(class, .*-cluster-carousel__pager-item.*), ymaps:regex(class, .*-cluster-carousel__nav.*)",function(event){event.stopPropagation(),clearTimeout(globalRestartID1),clearTimeout(globalRestartID2),clearTimeout(globalRestartID3),clearTimeout(globalRestartID4),waitLoadContent()}),function(){let $tempSidenav=$("#id_djeym_temp_sidenav");$("#djeymYMapsID").append($tempSidenav.html()),$tempSidenav.remove();let $matrixMenuBtn=$(".djeym-matrix-menu__btn");1===$matrixMenuBtn.length&&$matrixMenuBtn.eq(0).hide(),$(".djeym-tab-item").eq(0).addClass("djeym_tab_active").show()}();let customBalloonContentLayout=djeymYMaps.templateLayoutFactory.createClass('<div class="position-relative hight-100"><div id="djeymModalLock"><div id="djeymLoadIndicator"></div></div><div class="djeym_ballon_header">{{ properties.balloonContentHeader|raw }}</div><div class="djeym_ballon_body">{{ properties.balloonContentBody|raw }}</div><div class="djeym_ballon_footer">{{ properties.balloonContentFooter|raw }}</div></div>'),customIconContentLayoutForCluster=djeymYMaps.templateLayoutFactory.createClass('<div class="djeym_cluster_icon_content"><span style="background-color:'+window.djeymClusterIconContentBgColor+";color:"+window.djeymClusterIconContentTxtColor+';">$[properties.geoObjects.length]</span></div>'),geoObjectBalloonOptions={geoObjectHasBalloon:!0,geoObjectHasHint:!1,geoObjectBalloonMinWidth:322,geoObjectBalloonMaxWidth:342,geoObjectBalloonMinHeight:window.djeymBalloonMinHeight,geoObjectBalloonPanelMaxMapArea:0,geoObjectBalloonContentLayout:customBalloonContentLayout,geoObjectOpenBalloonOnClick:!1},objMngPlacemarkOptions={clusterize:window.djeymClusteringSite,clusterHasBalloon:!0,clusterHasHint:!1,clusterIconContentLayout:window.djeymClusterIconContent?customIconContentLayoutForCluster:null,clusterBalloonItemContentLayout:customBalloonContentLayout,clusterDisableClickZoom:!0,clusterOpenBalloonOnClick:!1,showInAlphabeticalOrder:!1,clusterBalloonPanelMaxMapArea:0,clusterMaxZoom:Map.options.get("maxZoom"),clusterBalloonContentLayout:window.djeymClusterLayout,clusterIcons:[{href:window.djeymCluster[0],size:window.djeymCluster[1],offset:window.djeymCluster[2],shape:{type:"Circle",coordinates:[0,0],radius:parseInt(Math.min.apply(null,window.djeymCluster[1])/2)}}]};function clearContentGeoObject(geoObject){return geoObject.properties.balloonContentHeader="",geoObject.properties.balloonContentBody="",geoObject.properties.balloonContentFooter="",geoObject}function djeymBalloonPanel(){let $window=$(window),actualWidth=$window.width(),actualHeight=$window.height(),$ymap=$("#djeymYMapsID"),mapWidth=$ymap.width(),mapHeight=$ymap.height();mapWidth<actualWidth&&(actualWidth=mapWidth),mapHeight<actualHeight&&(actualHeight=mapHeight),Map.balloon.close(),actualWidth<768||actualHeight<400?(globalObjMngPlacemark.clusters.options.set("balloonPanelMaxMapArea","Infinity"),globalObjMngPlacemark.objects.options.set("balloonPanelMaxMapArea","Infinity"),globalObjMngPolyline.objects.options.set("balloonPanelMaxMapArea","Infinity"),globalObjMngPolygon.objects.options.set("balloonPanelMaxMapArea","Infinity")):(globalObjMngPlacemark.clusters.options.set("balloonPanelMaxMapArea",0),globalObjMngPlacemark.objects.options.set("balloonPanelMaxMapArea",0),globalObjMngPolyline.objects.options.set("balloonPanelMaxMapArea",0),globalObjMngPolygon.objects.options.set("balloonPanelMaxMapArea",0))}function ajaxGetBalloonContent(geoObjectType,geoObject){Map.balloon.close(!0),setTimeout(function(){"Point"===geoObjectType?globalObjMngPlacemark.objects.balloon.open(geoObject.id):"LineString"===geoObjectType?globalObjMngPolyline.objects.balloon.open(geoObject.id):"Polygon"===geoObjectType&&globalObjMngPolygon.objects.balloon.open(geoObject.id)},100),$.get("/djeym/ajax-balloon-content/",{objID:geoObject.properties.id,objType:geoObjectType,presetsBool:!0}).done(function(data){geoObject.properties.balloonContentHeader=data.header,geoObject.properties.balloonContentBody=data.body,geoObject.properties.balloonContentFooter=data.footer,"Point"===geoObjectType?globalObjMngPlacemark.objects.balloon.setData(geoObject):"LineString"===geoObjectType?globalObjMngPolyline.objects.balloon.setData(geoObject):"Polygon"===geoObjectType&&globalObjMngPolygon.objects.balloon.setData(geoObject)}).fail(function(jqxhr,textStatus,error){let err=textStatus+", "+error;console.log("Request Failed: "+err)})}function addPlacemarkTypeObjects(geoObjects){globalObjMngPlacemark.add({type:"FeatureCollection",features:geoObjects})}function addHeatPoints(geoObjects){window.djeymHeatmap&&(globalHeatPoints.features.push(geoObjects),globalHeatmap.setData(globalHeatPoints))}function addPolylineTypeObjects(geoObjects){globalObjMngPolyline.add({type:"FeatureCollection",features:geoObjects})}function addPolygonTypeObjects(geoObjects){globalObjMngPolygon.add({type:"FeatureCollection",features:geoObjects})}function errorProcessing(jqxhr,textStatus,error){let err=textStatus+", "+error,errDetail="";void 0!==jqxhr.responseJSON&&jqxhr.responseJSON.hasOwnProperty("detail")&&(errDetail=jqxhr.responseJSON.detail,swal({type:"warning",html:errDetail,showCloseButton:!0})),0!==errDetail.length?console.log("Request Failed: "+err+" - "+errDetail):console.log("Request Failed: "+err)}Object.assign(objMngPlacemarkOptions,geoObjectBalloonOptions),globalObjMngPlacemark=new djeymYMaps.ObjectManager(objMngPlacemarkOptions),globalObjMngPolyline=new djeymYMaps.ObjectManager(geoObjectBalloonOptions),globalObjMngPolygon=new djeymYMaps.ObjectManager(geoObjectBalloonOptions),$(window).on("resize",function(){djeymBalloonPanel()}),djeymBalloonPanel(),globalObjMngPlacemark.clusters.events.add("click",function(event){Map.balloon.close(!0);let objectId=event.get("objectId"),cluster,geoObjects=globalObjMngPlacemark.clusters.getById(objectId).properties.geoObjects,countObjs=geoObjects.length,ids=[];for(let idx=0;idx<countObjs;idx++)ids.push(geoObjects[idx].properties.id);for(let idx=0;idx<countObjs;idx++)globalObjMngPlacemark.clusters.balloon.setData(clearContentGeoObject(geoObjects[idx]));setTimeout(function(){globalObjMngPlacemark.clusters.balloon.open(objectId)},100),$.get("/djeym/ajax-balloon-content/",{ids:JSON.stringify(ids),objType:"Point",presetsBool:!0}).done(function(data){for(let idx=0,marker,content;idx<countObjs;idx++)content=data[(marker=geoObjects[idx]).properties.id],marker.properties.balloonContentHeader=content.header,marker.properties.balloonContentBody=content.body,marker.properties.balloonContentFooter=content.footer;$("ymaps:regex(class, .*-cluster-tabs__menu-item.*)").eq(0).trigger("click")}).fail(function(jqxhr,textStatus,error){let err=textStatus+", "+error;console.log("Request Failed: "+err)})}),globalObjMngPlacemark.objects.events.add("click",function(event){let objectId=event.get("objectId"),geoObject=globalObjMngPlacemark.objects.getById(objectId);ajaxGetBalloonContent((geoObject=clearContentGeoObject(geoObject)).geometry.type,geoObject)}),globalObjMngPolyline.objects.events.add("click",function(event){let objectId=event.get("objectId"),geoObject=globalObjMngPolyline.objects.getById(objectId);ajaxGetBalloonContent((geoObject=clearContentGeoObject(geoObject)).geometry.type,geoObject)}),globalObjMngPolygon.objects.events.add("click",function(event){let objectId=event.get("objectId"),geoObject=globalObjMngPolygon.objects.getById(objectId);ajaxGetBalloonContent((geoObject=clearContentGeoObject(geoObject)).geometry.type,geoObject)}),$(".filter-by-category-placemarks, .filter-by-category-submarks").on("change",function(){let subcategoriesIDs=[],categoriesIDs=[],countSubcategories;if($(".filter-by-category-submarks:checked").each(function(idx,elem){subcategoriesIDs.push(+$(elem).val())}),$(".filter-by-category-placemarks:checked").each(function(idx,elem){categoriesIDs.push(+$(elem).val())}),countSubcategories=subcategoriesIDs.length,0!==subcategoriesIDs.length){let tmpIDs;globalObjMngPlacemark.setFilter(function(object){return tmpIDs=object.properties.subCategoryIDs,categoriesIDs.includes(object.properties.categoryID)&&tmpIDs.filter(num=>subcategoriesIDs.includes(num)).length===countSubcategories})}else globalObjMngPlacemark.setFilter(function(object){return categoriesIDs.includes(object.properties.categoryID)})}),$(".filter-by-category-polylines").on("change",function(){let categoriesIDs=[];$(".filter-by-category-polylines:checked").each(function(idx,elem){categoriesIDs.push(+$(elem).val())}),globalObjMngPolyline.setFilter(function(object){return categoriesIDs.includes(object.properties.categoryID)})}),$(".filter-by-category-polygons").on("change",function(){let categoriesIDs=[];$(".filter-by-category-polygons:checked").each(function(idx,elem){categoriesIDs.push(+$(elem).val())}),globalObjMngPolygon.setFilter(function(object){return categoriesIDs.includes(object.properties.categoryID)})}),Map.geoObjects.add(globalObjMngPlacemark),Map.geoObjects.add(globalObjMngPolyline),Map.geoObjects.add(globalObjMngPolygon),setTimeout(function(){function loadPlacemarkGeoObjects(offset){$.getJSON("/djeym/ajax-get-geo-objects-placemark/",{map_id:window.djeymMapID,offset:offset}).done(function(data){data.length>0?(addPlacemarkTypeObjects(data),loadPlacemarkGeoObjects(offset+=1e3)):setTimeout(function(){loadHeatPoints(0)},0)}).fail(function(jqxhr,textStatus,error){errorProcessing(jqxhr,textStatus,error)})}function loadHeatPoints(offset){$.getJSON("/djeym/ajax-get-heat-points/",{map_id:window.djeymMapID,offset:offset}).done(function(data){data.length>0?(addHeatPoints(data),loadHeatPoints(offset+=1e3)):setTimeout(function(){loadPolylineGeoObjects(0)},0)}).fail(function(jqxhr,textStatus,error){errorProcessing(jqxhr,textStatus,error)})}function loadPolylineGeoObjects(offset){$.getJSON("/djeym/ajax-get-geo-objects-polyline/",{map_id:window.djeymMapID,offset:offset}).done(function(data){data.length>0?(addPolylineTypeObjects(data),loadPolylineGeoObjects(offset+=500)):setTimeout(function(){loadPolygonGeoObjects(0)},0)}).fail(function(jqxhr,textStatus,error){errorProcessing(jqxhr,textStatus,error)})}function loadPolygonGeoObjects(offset){$.getJSON("/djeym/ajax-get-geo-objects-polygon/",{map_id:window.djeymMapID,offset:offset}).done(function(data){data.length>0?(addPolygonTypeObjects(data),loadPolygonGeoObjects(offset+=500)):setTimeout(function(){panelActivation()},0)}).fail(function(jqxhr,textStatus,error){errorProcessing(jqxhr,textStatus,error)})}function panelActivation(){$("#id_djeym_sidenav .djeym-closebtn").on("click",function(event){document.getElementById("id_djeym_sidenav").style.left="-360px"}),$(".djeym-matrix-menu__btn").on("click",function(event){let $this=$(this),tabIDName=$this.data("id_name");$this.hasClass("djeym_tab_active")||($(".djeym-matrix-menu__btn").removeClass("djeym_tab_active"),$this.addClass("djeym_tab_active"),$(".djeym-tab-item").hide(),document.getElementById(tabIDName).style.display="block")}),function(){let $this;$(".filter-by-category-placemarks").each(function(){($this=$(this)).boxiosCheckbox({size:GLOBAL_BOXIOS_SIZE,jackColor:$this.data("jack_color")})}),$(".filter-by-category-submarks").each(function(){($this=$(this)).boxiosCheckbox({size:GLOBAL_BOXIOS_SIZE,jackColor:$this.data("jack_color")})}),$(".filter-by-category-polylines").each(function(){($this=$(this)).boxiosCheckbox({size:GLOBAL_BOXIOS_SIZE,jackColor:$this.data("jack_color")})}),$(".filter-by-category-polygons").each(function(){($this=$(this)).boxiosCheckbox({size:GLOBAL_BOXIOS_SIZE,jackColor:$this.data("jack_color")})})}(),navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&$(".djeym-button").css("padding","3px 20px"),window.djeymDisableSitePanel||setTimeout(function(){Map.controls.add(globalButtonShowPanel,{position:{left:"10px",top:"59px"}})},500)}loadPlacemarkGeoObjects(0)},2e3)}djeymYMaps.ready(init);